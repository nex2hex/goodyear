/*
 * Goodyear 1.0
 * Timur Arefev (http://timurarefev.ru), Ilya Birman (http://ilyabirman.ru)
 * 2014
 */
 
(function(e){jQuery.fn.goodyear=function(t){t=e.extend({format:"D MMM YYYY г."},t);var n={single_date_item_width:25,single_date_item_height:21,year_block_height:269,year_selection_top:119,year_selection_border_top:1,single_year_item_height:32,month_block_height:240,month_slider_height:43,month_slider_top_manual_correction:1,single_month_item_height:20,date_block_height:267,date_block_month_block_padding_top:5,date_block_month_block_padding_bottom:5,date_block_label_height:21,date_block_label_border_bottom:1,range_from_text_block_to_picker:3,picker_open:null};var r={container:function(){return"<div class='goodyear-container'><div class='goodyear-icon'></div><div class='goodyear-picker'><div class='goodyear-date-picker'><div class='goodyear-slider'>"+r.days()+"</div></div><div class='goodyear-month-picker'><div class='goodyear-months'>"+r.months()+"</div><div class='goodyear-slider'><div class='goodyear-months'>"+r.months()+"</div></div></div><div class='goodyear-date-picker-label'><div class='goodyear-date-picker-label-background'></div><span class='goodyear-monday'>"+s.days_of_week[0]+"</span><span class='goodyear-tuesday'>"+s.days_of_week[1]+"</span><span class='goodyear-wednesday'>"+s.days_of_week[2]+"</span><span class='goodyear-thursday'>"+s.days_of_week[3]+"</span><span class='goodyear-friday'>"+s.days_of_week[4]+"</span><span class='goodyear-saturday'>"+s.days_of_week[5]+"</span><span class='goodyear-sunday'>"+s.days_of_week[6]+"</span></div><div class='goodyear-year-picker'><div class='goodyear-years'><div class='goodyear-years-floating-block'>"+r.years()+"</div></div><div class='goodyear-current-year-selection'><div class='goodyear-years-floating-block'>"+r.years()+"</div></div></div></div></div>"},years:function(e,n){var r="";for(i=t.min_year;i<=t.max_year;i++){r+="<div class='goodyear-year"+(o.today.format("YYYY")==i?" today":"")+"'><span>"+i+(o.today.format("YYYY")==i?" &bull;":"")+"</span></div>"}return r},months:function(){var e="";for(month_num=0;month_num<12;month_num++){e+="<div class='goodyear-month"+(o.today.format("M")==month_num+1?" today":"")+"'>"+s.months_ru_short[month_num]+(o.today.format("M")==month_num+1?"<span class='bull'> &bull;</span>":"")+"</div>"}return e},days:function(){var e="";for(month_num=0;month_num<12;month_num++){var t=moment(o.selected_date.format("YYYY")+"-"+(month_num+1)+"-01","YYYY-M-DD");var r=t.format("e");var i=t.add("months",1).subtract("days",1).format("D");var u=(r>2?9:2)-r;var a=(9-u)*n.single_date_item_width;var f=(4-u)*n.single_date_item_width;var l=(2-u)*n.single_date_item_width;var c=(0-u)*n.single_date_item_width;var h=(0-u)*n.single_date_item_width;var p=(0-u)*n.single_date_item_width;e+="<div class='goodyear-month goodyear-"+s.months_en[month_num]+"' data-month-id='"+month_num+"'><div class='goodyear-label'>"+s.months_ru[month_num].substr(0,1).toUpperCase()+s.months_ru[month_num].substr(1)+"</div><div class='goodyear-line_1'><div class='goodyear-weekdays'><div class='goodyear-slide_line' style='left:"+a+"px;'><span date='1'>1</span><span date='2'>2</span></div></div><div class='goodyear-weekend'><div class='goodyear-slide_line' style='left:"+f+"px;'><span date='1'>1</span><span date='2'>2</span><span date='3'>3</span><span date='4'>4</span></div></div></div><div class='goodyear-line_2'><div class='goodyear-weekdays'><div class='goodyear-slide_line' style='left:"+l+"px;'><span date='1'>1</span><span date='2'>2</span><span date='3'>3</span><span date='4'>4</span><span date='5'>5</span><span date='6'>6</span><span date='7'>7</span><span date='8'>8</span><span date='9'>9</span></div></div><div class='goodyear-weekend'><div class='goodyear-slide_line' style='left:"+c+"px;'><span date='4'>4</span><span date='5'>5</span><span date='6'>6</span><span date='7'>7</span><span date='8'>8</span><span date='9'>9</span><span date='10'>10</span><span date='11'>11</span></div></div></div><div class='goodyear-line_3'><div class='goodyear-weekdays'><div class='goodyear-slide_line' style='left:"+h+"px;'><span date='6'>6</span><span date='7'>7</span><span date='8'>8</span><span date='9'>9</span><span date='10'>10</span><span date='11'>11</span><span date='12'>12</span><span date='13'>13</span><span date='14'>14</span><span date='15'>15</span><span date='16'>16</span></div></div><div class='goodyear-weekend'><div class='goodyear-slide_line' style='left:"+p+"px;'><span date='11'>11</span><span date='12'>12</span><span date='13'>13</span><span date='14'>14</span><span date='15'>15</span><span date='16'>16</span><span date='17'>17</span><span date='18'>18</span></div></div></div><div class='goodyear-line_4'><div class='goodyear-weekdays'><div class='goodyear-slide_line' style='left:"+h+"px;'><span date='13'>13</span><span date='14'>14</span><span date='15'>15</span><span date='16'>16</span><span date='17'>17</span><span date='18'>18</span><span date='19'>19</span><span date='20'>20</span><span date='21'>21</span><span date='22'>22</span><span date='23'>23</span></div></div><div class='goodyear-weekend'><div class='goodyear-slide_line' style='left:"+p+"px;'><span date='18'>18</span><span date='19'>19</span><span date='20'>20</span><span date='21'>21</span><span date='22'>22</span><span date='23'>23</span><span date='24'>24</span><span date='25'>25</span></div></div></div><div class='goodyear-line_5'><div class='goodyear-weekdays'><div class='goodyear-slide_line' style='left:"+h+"px;'><span date='20'>20</span><span date='21'>21</span><span date='22'>22</span><span date='23'>23</span><span date='24'>24</span><span date='25'>25</span><span date='26'>26</span><span date='27'>27</span><span date='28'>28</span><span date='29' "+(i<29?"style='display:none'":"")+">29</span><span date='30' "+(i<30?"style='display:none'":"")+">30</span></div></div><div class='goodyear-weekend'><div class='goodyear-slide_line' style='left:"+p+"px;'><span date='25'>25</span><span date='26'>26</span><span date='27'>27</span><span date='28'>28</span><span date='29' "+(i<29?"style='display:none'":"")+">29</span><span date='30' "+(i<30?"style='display:none'":"")+">30</span><span date='d31' "+(i<31?"style='display:none'":"")+">31</span></div></div></div><div class='goodyear-line_6'><div class='goodyear-weekdays'><div class='goodyear-slide_line' style='left:"+h+"px;'><span date='27'>27</span><span date='28'>28</span><span date='29' "+(i<29?"style='display:none'":"")+">29</span><span date='30' "+(i<30?"style='display:none'":"")+">30</span><span date='31' "+(i<31?"style='display:none'":"")+">31</span></div></div></div></div>"}return e}};var s={months_en:["january","febrary","march","april","may","june","july","august","september","october","november","december"],months_ru:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],months_ru_short:["янв","фев","мар","апр","май","июнь","июль","авг","сен","окт","ноя","дек"],months_ru_genitive:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],days_of_week:["П","В","С","Ч","П","С","В"],common_date_formats:[["D M","DD M","DD MM","D-M","DD-M","DD-MM","D.M","DD.M","DD.MM","D\\M","DD\\M","DD\\MM","D/M","DD/M","DD/MM","D M YY","DD M YY","DD MM YY","D M YYYY","DD M YYYY","DD MM YYYY","D-M-YY","DD-M-YY","DD-MM-YY","D-M-YYYY","DD-M-YYYY","DD-MM-YYYY","D.M.YY","DD.M.YY","DD.MM.YY","D.M.YYYY","DD.M.YYYY","DD.MM.YYYY","D\\M\\YY","DD\\M\\YY","DD\\MM\\YY","D\\M\\YYYY","DD\\M\\YYYY","DD\\MM\\YYYY","D/M/YY","DD/M/YY","DD/MM/YY","D/M/YYYY","DD/M/YYYY","DD/MM/YYYY","D M YY","DD M YY","DD MM YY","D M YYYY","DD M YYYY","DD MM YYYY","D-M-YY","DD-M-YY","DD-MM-YY","D-M-YYYY","DD-M-YYYY","DD-MM-YYYY","D.M.YY","DD.M.YY","DD.MM.YY","D.M.YYYY","DD.M.YYYY","DD.MM.YYYY","D\\M\\YY","DD\\M\\YY","DD\\MM\\YY","D\\M\\YYYY","DD\\M\\YYYY","DD\\MM\\YYYY","D/M/YY","DD/M/YY","DD/MM/YY","D/M/YYYY","DD/M/YYYY","DD/MM/YYYY","YY M D","YY M DD","YY MM DD","YYYY M D","YYYY M DD","YYYY MM DD","YY-M-D","YY-M-DD","YY-MM-DD","YYYY-M-D","YYYY-M-DD","YYYY-MM-DD","YY.M.D","YY.M.DD","YY.MM.DD","YYYY.M.D","YYYY.M.DD","YYYY.MM.DD","YY\\M\\D","YY\\M\\DD","YY\\MM\\DD","YYYY\\M\\D","YYYY\\M\\DD","YYYY\\MM\\DD","YY/M/D","YY/M/DD","YY/MM/DD","YYYY/M/D","YYYY/M/DD","YYYY/MM/DD","YY D M","YY DD M","YY DD MM","YYYY D M","YYYY DD MM","YYYY DD MM","YY-D-M","YY-DD-M","YY-DD-MM","YYYY-D-M","YYYY-DD-MM","YYYY-DD-MM","YY.D.M","YY.DD.M","YY.DD.MM","YYYY.D.M","YYYY.DD.MM","YYYY.DD.MM","YY\\D\\M","YY\\DD\\M","YY\\DD\\MM","YYYY\\D\\M","YYYY\\DD\\MM","YYYY\\DD\\MM","YY/D/M","YY/DD/M","YY/DD/MM","YYYY/D/M","YYYY/DD/MM","YYYY/DD/MM","D MMM","DD MMM"],["YYYY MMM D","YYYY MMM DD","YYYY D MMM","YYYY DD MMM","D MMM YY","DD MMM YY","D MMM YYYY","DD MMM YYYY","D MMM YY","DD MMM YY","D MMM YYYY","DD MMM YYYY","MMM D YYYY","MMM DD YYYY","YY MMM D","YY MMM DD","YY D MMM","YY DD MMM","D MMM","DD MMM"],["YYYY MMM D","YYYY MMM DD","YYYY D MMM","YYYY DD MMM","D MMM YY","DD MMM YY","D MMM YYYY","DD MMM YYYY","D MMM YY","DD MMM YY","D MMM YYYY","DD MMM YYYY","MMM D YYYY","MMM DD YYYY","YY MMM D","YY MMM DD","YY D MMM","YY DD MMM"]],common_date_langs:["ru","en"]};var o={input_text_value:null,selected_date:null,today:null,displayed_year:null,container:null,drag_item:null,drag_start_pos_y:null,drag_start_element_top:null,drag_started:null,is_mobile:null,input_text_error:null,mousewheel:null};var u={wrap_element:function(n){var i=e(r.container()).clone();i.css("width",parseInt(n.css("width"),10)+parseInt(n.css("paddingLeft"),10)+parseInt(n.css("paddingRight"),10)+parseInt(n.css("borderLeftWidth"),10)+parseInt(n.css("borderRightWidth"),10));n.replaceWith(i);n.addClass("goodyear-text").val(o.input_text_value).prependTo(i);o.container=i;if(o.input_text_value==o.selected_date.format(t.format)){o.container.removeClass("goodyear-error");o.input_text_error=false}else{if(o.input_text_value){o.container.addClass("goodyear-error");o.input_text_error=true}}var s=new RegExp("mobile|android","i");o.is_mobile=s.test(navigator.userAgent);u.set_date();u.input_icon_hover();if(!o.is_mobile){u.show_and_hide_picker()}u.set_date_on_blur();u.months_hover();u.months_click();u.months_drag();u.months_mousewheel();u.year_mouseenter();u.year_click();u.year_drag();u.year_mousewheel();u.date_hover();u.date_pick(i)},document_actions:function(){e("html").mouseup(function(){if(!o.drag_item){e(".goodyear-picker").css("zIndex",1);e(".goodyear-picker").fadeOut(100);o.picker_open=false}})},input_icon_hover:function(){o.container.find(".goodyear-icon").mouseenter(function(){e(this).addClass("hover")}).mouseleave(function(){e(this).removeClass("hover")}).click(function(){o.container.find(".goodyear-text").trigger("focus")})},set_date:function(){var e=o.container.find(".goodyear-year-picker");var r=parseInt(o.selected_date.format("YYYY"),10)-t.min_year;var i=-(r*n.single_year_item_height)+n.year_selection_top+n.year_selection_border_top;e.find(".goodyear-years").find(".goodyear-years-floating-block").stop(true,true);e.find(".goodyear-years").find(".goodyear-years-floating-block").animate({top:i+"px"},{duration:o.displayed_year?Math.abs(parseInt(o.selected_date.format("YYYY"),10)-o.displayed_year)*200<1e3?Math.abs(parseInt(o.selected_date.format("YYYY"),10)-o.displayed_year)*200:1e3:0,step:function(t,r){e.find(".goodyear-years").find(".goodyear-years-floating-block").data("top",t);e.find(".goodyear-current-year-selection").find(".goodyear-years-floating-block").css("top",t-(n.year_selection_top+n.year_selection_border_top)+"px")}});prev_displayed_year=o.displayed_year;o.displayed_year=parseInt(o.selected_date.format("YYYY"),10);if(o.displayed_year!=prev_displayed_year)u.year_change_date_block_reaction();var a=o.container.find(".goodyear-month-picker").find(".goodyear-slider");var f=-Math.floor((n.month_slider_height-n.single_month_item_height)/2);var l=(parseInt(o.selected_date.format("M"),10)-1)*n.single_month_item_height+f+n.month_slider_top_manual_correction;if(l<0)l=0;if(l>n.month_block_height-n.month_slider_height)l=n.month_block_height-n.month_slider_height;var c=o.container.find(".goodyear-date-picker").find(".goodyear-slider");var h=n.date_block_height-n.date_block_label_height-n.date_block_label_border_bottom;var p=12*(6*n.date_block_label_height+(n.date_block_month_block_padding_top>n.date_block_month_block_padding_bottom?n.date_block_month_block_padding_top:n.date_block_month_block_padding_bottom))+n.date_block_month_block_padding_bottom;var d=p-h;a.stop(true,true);a.animate({top:l+"px"},{duration:3*Math.abs(parseInt(a.css("top"),10)-l),step:function(e,t){a.find(".goodyear-months").css("top",-e+"px");var r=n.date_block_label_height+n.date_block_label_border_bottom-d*(e/(n.month_block_height-n.month_slider_height));c.css("top",r+"px");c.data("top",r);a.data("top",e)}});c.find(".goodyear-month").filter(".goodyear-"+s.months_en[o.today.format("M")-1]).find("span").filter("[date='"+o.today.format("D")+"']").addClass("today").append("<div class='bull'>&bull;</div>");c.find(".goodyear-month").find(".goodyear-slide_line").find("span").filter(".active").addClass("prev_active");c.find(".goodyear-month").find("span").filter(".active").removeClass("active");c.find(".goodyear-month").filter(".goodyear-"+s.months_en[o.selected_date.format("M")-1]).find("span").filter("[date='"+o.selected_date.format("D")+"']").addClass("hover").addClass("active").removeClass("hover")},year_change_date_block_reaction:function(){var t=o.container.find(".goodyear-date-picker").find(".goodyear-slider");var r=o.container.find(".goodyear-month-picker").find(".goodyear-slider");if(o.selected_date.format("YYYY")!=o.displayed_year){t.find(".goodyear-month").find(".goodyear-slide_line").find("span").removeClass("active")}else{t.find(".goodyear-month").filter(".goodyear-"+s.months_en[parseInt(o.selected_date.format("M"),10)-1]).find("span").filter("[date='"+o.selected_date.format("D")+"']").addClass("active")}if(o.today.format("YYYY")!=o.displayed_year){t.find(".goodyear-month").find(".goodyear-slide_line").find("span").removeClass("today");o.container.find(".goodyear-month-picker").find(".goodyear-month").removeClass("today")}else{t.find(".goodyear-month").filter(".goodyear-"+s.months_en[parseInt(o.today.format("M"),10)-1]).find("span").filter("[date='"+o.today.format("D")+"']").addClass("today");o.container.find(".goodyear-months").each(function(){e(this).find(".goodyear-month").eq(parseInt(o.today.format("M"),10)-1).addClass("today")})}o.container.find(".goodyear-date-picker").find(".goodyear-month").each(function(){var r=o.container.find(".goodyear-date-picker").find(".goodyear-month").index(e(this));var i=moment(o.displayed_year+"-"+(r+1)+"-01","YYYY-M-DD");var u=i.format("e");var a=i.add("months",1).subtract("days",1).format("D");var f=(u>2?9:2)-u;var l=(9-f)*n.single_date_item_width;o.container.find(".goodyear-date-picker").find(".goodyear-month").eq(r).find(".goodyear-line_1").find(".goodyear-weekdays").find(".goodyear-slide_line").stop(true,true);o.container.find(".goodyear-date-picker").find(".goodyear-month").eq(r).find(".goodyear-line_1").find(".goodyear-weekdays").find(".goodyear-slide_line").animate({left:l},{duration:1e3,step:function(e,t){var i=9-e/n.single_date_item_width;var s=(4-i)*n.single_date_item_width;o.container.find(".goodyear-date-picker").find(".goodyear-month").eq(r).find(".goodyear-line_1").find(".goodyear-weekend").find(".goodyear-slide_line").css({left:s});var u=(2-i)*n.single_date_item_width;o.container.find(".goodyear-date-picker").find(".goodyear-month").eq(r).find(".goodyear-line_2").find(".goodyear-weekdays").find(".goodyear-slide_line").css({left:u});var a=(0-i)*n.single_date_item_width;o.container.find(".goodyear-date-picker").find(".goodyear-month").eq(r).find(".goodyear-line_2").find(".goodyear-weekend").find(".goodyear-slide_line").css({left:a});var f=(0-i)*n.single_date_item_width;o.container.find(".goodyear-date-picker").find(".goodyear-month").eq(r).find(".goodyear-line_3,.goodyear-line_4,.goodyear-line_5,.goodyear-line_6").find(".goodyear-weekdays").find(".goodyear-slide_line").css({left:f});var l=(0-i)*n.single_date_item_width;o.container.find(".goodyear-date-picker").find(".goodyear-month").eq(r).find(".goodyear-line_3,.goodyear-line_4,.goodyear-line_5,.goodyear-line_6").find(".goodyear-weekend").find(".goodyear-slide_line").css({left:l})}});for(day=29;day<=31;day++){if(day<=a){t.find(".goodyear-month").filter(".goodyear-"+s.months_en[r]).find(".goodyear-slide_line").find("[date='"+day+"']").css("display","inline")}else{t.find(".goodyear-month").filter(".goodyear-"+s.months_en[r]).find(".goodyear-slide_line").find("[date='"+day+"']").css("display","none")}}})},show_and_hide_picker:function(){o.container.find(".goodyear-text").focus(function(){if(e("html").width()-o.container.offset().left-o.container.width()<o.container.find(".goodyear-picker").width()){o.container.find(".goodyear-picker").addClass("position-right")}else{o.container.find(".goodyear-picker").removeClass("position-right")}e(".goodyear-picker").not(o.container.find(".goodyear-picker")).parent().css("zIndex",1);e(".goodyear-picker").not(o.container.find(".goodyear-picker")).fadeOut(100);o.container.css("zIndex",2);o.container.find(".goodyear-picker").css("top",o.container.find(".goodyear-text").height()+parseInt(o.container.find(".goodyear-text").css("borderTopWidth"),10)+parseInt(o.container.find(".goodyear-text").css("borderBottomWidth"),10)+parseInt(o.container.find(".goodyear-text").css("paddingTop"),10)+parseInt(o.container.find(".goodyear-text").css("paddingBottom"),10)+n.range_from_text_block_to_picker);o.container.find(".goodyear-picker").css("display","block");o.picker_open=true;if(!o.is_mobile){setTimeout(function(){o.container.find(".goodyear-text")[0].select()},1)}}).click(function(){if(o.container.find(".goodyear-picker").css("display")!="block"){e(this).trigger("focus")}})},set_date_on_blur:function(){o.container.find(".goodyear-text").keydown(function(e){if(e.which==13){e.preventDefault();o.container.find(".goodyear-text").trigger("change");if(!o.is_mobile){setTimeout(function(){o.container.find(".goodyear-text")[0].select()},1)}}if(e.which==9){o.container.find(".goodyear-text").trigger("change");o.container.find(".goodyear-picker").css("zIndex",1);o.container.find(".goodyear-picker").fadeOut(100)}}).keyup(function(){o.input_text_value=e(this).val()});o.container.find(".goodyear-text").change(function(){var n=u.string_to_date(e(this).val());o.input_text_value=e(this).val();if(!n){o.container.addClass("goodyear-error");o.input_text_error=true}else if(n&&n.format("YYYY")>=t.min_year&&n.format("YYYY")<=t.max_year){o.selected_date=n;o.input_text_value=o.selected_date.format(t.format);u.set_date();o.container.find(".goodyear-text").val(o.input_text_value);o.container.removeClass("goodyear-error");o.input_text_error=false}})},months_hover:function(t){o.container.find(".goodyear-month-picker").children().filter(".goodyear-months").find(".goodyear-month").mouseenter(function(){e(this).addClass("hover")}).mouseleave(function(){e(this).removeClass("hover")})},months_drag:function(){var t=o.container.find(".goodyear-month-picker").find(".goodyear-slider");var r=o.container.find(".goodyear-date-picker").find(".goodyear-slider");t.stop(true,true);r.stop(true,true);var i=n.date_block_height-n.date_block_label_height-n.date_block_label_border_bottom;var s=12*(6*n.date_block_label_height+(n.date_block_month_block_padding_top>n.date_block_month_block_padding_bottom?n.date_block_month_block_padding_top:n.date_block_month_block_padding_bottom))+n.date_block_month_block_padding_bottom;var u=s-i;t.mousedown(function(i){t.addClass("drag");o.drag_started=false;o.drag_item=t;o.drag_start_pos_y=i.pageY;o.drag_start_element_top=parseInt(t.css("top"),10);e("html, body").addClass("disable_selection");e("html").mousemove(function(e){o.drag_started=true;if(o.drag_item==t){var i=o.drag_start_pos_y-e.pageY;var s=o.drag_start_element_top-i;if(s<0){s=0}if(s>n.month_block_height-n.month_slider_height){s=n.month_block_height-n.month_slider_height}date_slider_month_slider_top=s;o.drag_item.css("top",s);o.drag_item.data("top",s);t.find(".goodyear-months").css("top",-s+"px");var a=n.date_block_label_height+n.date_block_label_border_bottom-u*(date_slider_month_slider_top/(n.month_block_height-n.month_slider_height));r.css("top",a+"px");r.data("top",a)}})}).mouseenter(function(){e(this).addClass("hover")}).mouseleave(function(){e(this).removeClass("hover")});o.container.add(document).mouseup(function(n){n.stopPropagation();if(o.drag_item==t){o.drag_item=null;o.drag_start_pos_y=null;o.container.find(".goodyear-year-picker").removeClass("goodyear-drag_started");t.removeClass("drag");e("html").unbind("mousemove");e("html, body").removeClass("disable_selection");return false}})},months_mousewheel:function(){var e=n.date_block_height-n.date_block_label_height-n.date_block_label_border_bottom;var t=12*(6*n.date_block_label_height+(n.date_block_month_block_padding_top>n.date_block_month_block_padding_bottom?n.date_block_month_block_padding_top:n.date_block_month_block_padding_bottom))+n.date_block_month_block_padding_bottom;var r=t-e;var i=o.container.find(".goodyear-month-picker").find(".goodyear-slider");var s=o.container.find(".goodyear-date-picker").find(".goodyear-slider");if(o.mousewheel){o.container.find(".goodyear-date-picker,.goodyear-month-picker,.goodyear-date-picker-label").mousewheel(function(e){if(navigator.platform.indexOf("Win")!=-1){e.delta*=20;e.deltaX*=20;e.deltaY*=20}var t=(s.data("top")?s.data("top"):parseFloat(s.css("top")))+e.deltaY;if(t>n.date_block_label_height)t=n.date_block_label_height;if(t<n.date_block_label_height-r)t=n.date_block_label_height-r;var o=(n.month_block_height-n.month_slider_height)*((n.date_block_label_height+n.date_block_label_border_bottom-t)/r);i.css("top",o);i.find(".goodyear-months").css("top",-o+"px");s.data("top",t);s.css("top",t+"px");return false})}},months_click:function(){var t=o.container.find(".goodyear-month-picker").find(".goodyear-slider");var r=o.container.find(".goodyear-date-picker").find(".goodyear-slider");var i=n.date_block_height-n.date_block_label_height-n.date_block_label_border_bottom;var s=12*(6*n.date_block_label_height+(n.date_block_month_block_padding_top>n.date_block_month_block_padding_bottom?n.date_block_month_block_padding_top:n.date_block_month_block_padding_bottom))+n.date_block_month_block_padding_bottom;var u=s-i;o.container.find(".goodyear-month-picker").children().filter(".goodyear-months").find(".goodyear-month").click(function(){var i=o.container.find(".goodyear-month-picker").children().filter(".goodyear-months").find(".goodyear-month").index(e(this));var s=-Math.floor((n.month_slider_height-n.single_month_item_height)/2);var a=i*n.single_month_item_height+s+n.month_slider_top_manual_correction;if(a<0)a=0;if(a>n.month_block_height-n.month_slider_height)a=n.month_block_height-n.month_slider_height;t.stop(true,true);t.animate({top:a+"px"},{duration:3*Math.abs(parseInt(t.css("top"),10)-a),step:function(e,i){t.data("top",e);t.find(".goodyear-months").css("top",-e+"px");var s=n.date_block_label_height+n.date_block_label_border_bottom-u*(e/(n.month_block_height-n.month_slider_height));r.css("top",s+"px");r.data("top",s)}})})},year_mouseenter:function(t){o.container.find(".goodyear-year-picker").children().filter(".goodyear-years").find(".goodyear-year").find("span").unbind("mouseenter");o.container.find(".goodyear-year-picker").children().filter(".goodyear-years").find(".goodyear-year").find("span").mouseenter(function(){e(this).addClass("hover")}).mouseleave(function(){e(this).removeClass("hover")})},year_click:function(){var r=o.container.find(".goodyear-year-picker");o.container.find(".goodyear-year-picker").children().filter(".goodyear-years").find(".goodyear-year").find("span").unbind("click");o.container.find(".goodyear-year-picker").children().filter(".goodyear-years").find(".goodyear-year").find("span").click(function(){if(!o.drag_started){var i=o.displayed_year;o.displayed_year=parseInt(e(this).text(),10);var s=o.displayed_year-t.min_year;var a=-(s*n.single_year_item_height)+n.year_selection_top+n.year_selection_border_top;r.find(".goodyear-years").find(".goodyear-years-floating-block").stop(true,true);r.find(".goodyear-years").find(".goodyear-years-floating-block").animate({top:a+"px"},{duration:i?Math.abs(o.displayed_year-i)*200<1e3?Math.abs(o.displayed_year-i)*200:100:0,step:function(e,t){r.find(".goodyear-years").find(".goodyear-years-floating-block").data("top",e);r.find(".goodyear-current-year-selection").find(".goodyear-years-floating-block").css("top",e-(n.year_selection_top+n.year_selection_border_top)+"px")}});u.year_change_date_block_reaction()}})},year_drag:function(){var r=o.container.find(".goodyear-year-picker");r.stop(true,true);r.mousedown(function(i){o.drag_started=false;r.removeClass("drag_started");o.drag_item=r;o.drag_start_pos_y=i.pageY;o.drag_start_element_top=parseInt(r.find(".goodyear-years-floating-block").css("top"),10);e("html, body").addClass("disable_selection");e("html").mousemove(function(e){if(o.drag_item==r){o.drag_started=true;r.addClass("goodyear-drag_started");var i=o.drag_start_pos_y-e.pageY;var s=o.drag_start_element_top-i;var u=parseInt(o.selected_date.format("YYYY"),10)-t.min_year;var a=n.year_block_height-n.single_year_item_height*(t.max_year-t.min_year+1);if(s>n.year_selection_top+n.year_selection_border_top)s=n.year_selection_top+n.year_selection_border_top;if(s<-(n.year_block_height-n.year_selection_top-n.single_year_item_height-2*n.year_selection_border_top)+a)s=-(n.year_block_height-n.year_selection_top-n.single_year_item_height-2*n.year_selection_border_top)+a;r.find(".goodyear-years-floating-block").css("top",s);r.find(".goodyear-years-floating-block").data("top",s);r.find(".goodyear-current-year-selection").find(".goodyear-years-floating-block").css("top",s-(n.year_selection_top+n.year_selection_border_top)+"px")}})});o.container.add(document).mouseup(function(i){i.stopPropagation();if(o.drag_item==r){o.displayed_year=t.min_year+Math.round(Math.abs((parseInt(r.find(".goodyear-years-floating-block").css("top"),10)-n.year_selection_top+n.year_selection_border_top)/n.single_year_item_height));var s=o.displayed_year-t.min_year;var a=-(s*n.single_year_item_height)+n.year_selection_top+n.year_selection_border_top;r.find(".goodyear-years").find(".goodyear-years-floating-block").stop(true,true);r.find(".goodyear-years").find(".goodyear-years-floating-block").animate({top:a+"px"},{duration:200,step:function(e,t){r.find(".goodyear-years").find(".goodyear-years-floating-block").data("top",e);r.find(".goodyear-current-year-selection").find(".goodyear-years-floating-block").css("top",e-(n.year_selection_top+n.year_selection_border_top)+"px")}});u.year_change_date_block_reaction();o.drag_item=null;o.drag_start_pos_y=null;o.container.find(".goodyear-year-picker").removeClass("goodyear-drag_started");e("html").unbind("mousemove");e("html, body").removeClass("disable_selection");return false}})},year_mousewheel:function(){var e=o.container.find(".goodyear-year-picker");var r=0;var i=moment().valueOf();var s=n.year_block_height-n.single_year_item_height*(t.max_year-t.min_year+1);var a=false;var f=false;if(o.mousewheel){e.mousewheel(function(r){r.stopPropagation();r.preventDefault();if(navigator.platform.indexOf("Win")!=-1){r.delta*=20;r.deltaX*=20;r.deltaY*=20}var i=(e.find(".goodyear-years").find(".goodyear-years-floating-block").data("top")?e.find(".goodyear-years").find(".goodyear-years-floating-block").data("top"):parseFloat(e.find(".goodyear-years").find(".goodyear-years-floating-block").css("top"),10))+r.deltaY;if(i>n.year_selection_top+n.year_selection_border_top)i=n.year_selection_top+n.year_selection_border_top;if(i<-(n.year_block_height-n.year_selection_top-n.single_year_item_height-2*n.year_selection_border_top)+s)i=-(n.year_block_height-n.year_selection_top-n.single_year_item_height-2*n.year_selection_border_top)+s;e.find(".goodyear-years").find(".goodyear-years-floating-block").css("top",i);e.find(".goodyear-years").find(".goodyear-years-floating-block").data("top",i);e.find(".goodyear-current-year-selection").find(".goodyear-years-floating-block").css("top",i-(n.year_selection_top+n.year_selection_border_top)+"px");if(typeof f!="undefined"&&f!=false){clearTimeout(f)}f=setTimeout(function(){o.displayed_year=t.min_year+Math.round(Math.abs((parseInt(e.find(".goodyear-years-floating-block").css("top"),10)-n.year_selection_top+n.year_selection_border_top)/n.single_year_item_height));var r=o.displayed_year-t.min_year;var i=-(r*n.single_year_item_height)+n.year_selection_top+n.year_selection_border_top;e.find(".goodyear-years").find(".goodyear-years-floating-block").stop(true,true);e.find(".goodyear-years").find(".goodyear-years-floating-block").animate({top:i+"px"},{duration:200,step:function(t,r){e.find(".goodyear-years").find(".goodyear-years-floating-block").data("top",t);e.find(".goodyear-current-year-selection").find(".goodyear-years-floating-block").css("top",t-(n.year_selection_top+n.year_selection_border_top)+"px")}});u.year_change_date_block_reaction()},500)})}},date_hover:function(){var n=o.container.find(".goodyear-date-picker").find(".goodyear-slider");n.find(".goodyear-month").find(".goodyear-slide_line").find("span").mouseenter(function(){e(this).addClass("hover");o.container.find(".goodyear-text").val(moment(o.displayed_year+"-"+(parseInt(e(this).parents(".goodyear-month").data("monthId"),10)+1)+"-"+parseInt(e(this).text(),10),"YYYY-M-D").format(t.format));if(!o.is_mobile){setTimeout(function(){o.container.find(".goodyear-text")[0].select()},1)}}).mouseleave(function(){e(this).removeClass("hover");if(o.picker_open){o.container.find(".goodyear-text").val(o.input_text_value)}if(!o.is_mobile){setTimeout(function(){o.container.find(".goodyear-text")[0].select()},1)}})},date_pick:function(n){var r=o.container.find(".goodyear-date-picker").find(".goodyear-slider");r.find(".goodyear-month").find(".goodyear-slide_line").find("span").mousedown(function(){o.container.removeClass("goodyear-error")}).mouseleave(function(){if(o.input_text_error){o.container.addClass("goodyear-error")}}).click(function(){o.container.removeClass("goodyear-error");o.input_text_error=false;o.selected_date=moment(o.displayed_year+"-"+(parseInt(e(this).parents(".goodyear-month").data("monthId"),10)+1)+"-"+parseInt(e(this).text(),10),"YYYY-M-D");o.input_text_value=o.selected_date.format(t.format);o.container.find(".goodyear-text").val(o.input_text_value);u.set_date();o.container.find(".goodyear-text").focus();if(!o.is_mobile){setTimeout(function(){o.container.find(".goodyear-text")[0].select()},1)}o.container.find(".goodyear-picker").css("zIndex",1);o.container.find(".goodyear-picker").fadeOut(100);o.picker_open=false})},trim:function(e){if(e&&typeof e=="string")return e.replace(/^\s+|\s+$/g,"");else return""},string_to_date:function(e){for(i=0;i<s.common_date_langs.length;i++){var n=moment(u.trim(e),t.format,s.common_date_langs[i],true);if(n.isValid()){break}}if(!n.isValid()){for(k=0;k<s.common_date_formats.length;k++){for(i=0;i<s.common_date_langs.length;i++){var n=moment(u.trim(e),s.common_date_formats[k],s.common_date_langs[i],k<2);if(n.isValid()){break}}if(n.isValid()){break}}}if(n.isValid()){return n}else{return false}}};var a=function(){if(typeof e(this).data("goodyearFormat")!="undefined"){t.format=e(this).data("goodyearFormat")}if(typeof e(this).data("goodyearMinYear")!="undefined"){t.min_year=e(this).data("goodyearMinYear")}if(typeof e(this).data("goodyearMaxYear")!="undefined"){t.max_year=e(this).data("goodyearMaxYear")}if(typeof e(this).data("goodyearMinDate")!="undefined"){t.min_date=e(this).data("goodyearMinDate")}if(typeof e(this).data("goodyearMaxDate")!="undefined"){t.max_date=e(this).data("goodyearMaxDate")}moment.lang("ru");var n=u.string_to_date(e(this).val());o.today=moment();t.min_date=u.string_to_date(t.min_date);if(t.min_date){t.min_year=t.min_date.format("YYYY")}else if(t.min_year){t.min_date=u.string_to_date(t.min_year+"-01-01")}else{if(n){t.min_year=parseInt(n.format("YYYY"),10)-50}else{t.min_year=parseInt(o.today.format("YYYY"),10)-50}t.min_date=u.string_to_date(t.min_year+"-01-01")}t.max_date=u.string_to_date(t.max_date);if(t.max_date){t.max_year=t.max_date.format("YYYY")}else if(t.max_year){t.max_date=u.string_to_date(t.max_year+"-01-01")}else{if(n){t.max_year=parseInt(n.format("YYYY"),10)+50}else{t.max_year=parseInt(o.today.format("YYYY"),10)+50}t.max_date=u.string_to_date(t.max_year+"-01-01").endOf("year")}if(n&&n>=t.min_date&&n<=t.max_date){o.selected_date=n;o.input_text_value=o.selected_date.format(t.format)}else if(o.today>=t.min_date&&o.today<=t.max_date){o.selected_date=o.today;o.input_text_value=e(this).val()}else{o.selected_date=t.min_date;o.input_text_value=e(this).val()}if(jQuery().mousewheel){o.mousewheel=true}u.document_actions();u.wrap_element(e(this))};return this.each(a)}})(jQuery);$(document).ready(function(){var e=new RegExp("^.*?goodyear[^/]*?$","i");var t=new RegExp("^(.*?)[^/]*?$","i");var n=false;var r=false;$("script").filter("[src*='goodyear']").each(function(){if(e.test($(this).attr("src"))){n=t.exec($(this).attr("src"))[1];r=$(this)}});if(n)if(typeof moment=="undefined"){$("<script src='"+n+"moment-with-langs.min.js'></script>").insertAfter(r)}if(n)if(!jQuery().mousewheel){$("<script src='"+n+"jquery-mousewheel-3.1.11.min.js'></script>").insertAfter(r)}$(".goodyear").each(function(){$(this).goodyear()})})